## 网易云音乐的首页部分功能实现

+  **适合人群**

  -  有html，css，javascript的基础， 刚刚学习完vue的基础语法，需要小项目对vue的知识或js知识巩固的人。

    

+ **你能学到什么**

  - vue同级组件的通讯

    > 通过建立一个空的事件总线，子组件发送到父组件，父组件传到子组件完成同级组件的通讯。请结合实际代码理解。

  - vue-router的使用

    > 简单的路由渲染，详情查看router.index.js

  - axios 的 封装

    > 详情查看plugins/axios.js

+ node版本

  > v12.16.2

+ **功能介绍**

  - 轮播图 与 两边的背景图片展示

    > - 先请求好轮播图的数据，将它保存到data里。自动只需操作DOM元素赋值背景图片即可。值得注意的是还有得将定时器的返回值返回，用以重新计算。当鼠标进入的时候，移除该定时器，鼠标移出的时候重新执行自动切换函数，并赋值用于保存该函数的值便于当移出鼠标时清理的是当前的计时器。
    >
    > - 鼠标切换背景图片，由于当初刚写这个项目的时候使用了Element-UI 的组件 ，导致这个功能的实现并不完美。原意是通过点击就直接切换背景图片。但始终没有这个效果，试过不少方法最后放弃了，改为mouseover，算半个实现把。

  - 播放

    > - 抽离了一个音乐参数赋值的函数，下一首，上一首都得改变参数对视图进行渲染，与播放器的src进行赋值。
    > - 将歌曲的索引全交由 modeJudge 模式判定函数实现。值得一提的是随机播放的功能，经过本人测试，在随机播放模式下，当你点击下一首随机播放的时候，它会存储当前的索引，点击上一首则回到最近的一个歌曲索引播放。结合这段看下代码应该就清楚了。当切换模式之后，清空该数组。
    > - 进度条通过比例进行控制，设置宽度的百分比即可。
    > - 缓冲条看不懂的上网搜索audio.buffered即可
    > - 图标拖动实现播放，点击的时候停止播放时间更新，播放器让它正常播放，拖动的同时更新现在的时间，松开再将当前的时间赋值给播放器，然后将标志变量更改为正常更新播放时间。
    > - 点击实现跳转播放，获取当前位置的宽度 / 总进度条宽度 ，得到该比例后乘音乐的总时间 得当前位置的音乐时间。再更新一下进度条与缓冲条。

  - 获取audio的duration之前为NaN的 Vue的解决方案 （此处可跳过，算是对坑做个总结）

    > 上网查了许多资料，都是说在重新设置src的时候先load重新加载一下。始终不经用，然后 durationchange 事件里 进行设置也始终不管用。 然后改变思路，使用v-if 渲染数据，终于正常显示了。

  - 新碟上架左右滑动功能

    > - 参考了网易云的HTML设计，从第二个开始展示，左边一个隐藏元素，右边两个隐藏元素。点击向右时，当前ul列表向左滑动一个宽度，使下一个ul列表的left为0表示显示，使下下一个ul列表放于一个宽度的右边。如此反复。
    >
    > - 美化设计，如不加transition 画面显示过于枯燥，加了之后得注意需要将上2个操作的DOM元素的transition变为0，你可以试试不加会有什么效果。

  - 播放列表

    > - 鼠标在列表里滚动事件，判断滚轮的方向，判断边界，鼠标向上，ul内容往下走。主要思路： 本次ul内容滑动的距离 / (ul内容能滑动的距离)   =  本次滚动条移动的距离 / (滚动条能移动的距离)
    > - 点击列表的滚动条事件 ，首先得判断滚动条是否该出现，ul列表是否有溢出。对该比例判断存在疑惑得往scrollHeight等等这些去搜索。当鼠标发生滚动事件时：滚动条该移动的距离 = 当前移动的Y - 鼠标按下的时候的Y  + 距离顶部边框的Y（此Y 得保存，确保这个值是正确的），注意边界条件的判断。
    > - 点击列表的项进行播放， 改变 歌曲索引，调用改变音乐参数函数，添加播放图标，同时移除之前的播放图标。

  - 登录

    > 只完善了手机号登录的功能，自动登录效果不用多余的去实现，后台传送的数据包含cookie，可自动保存。
    >
    > ​	思路：点击登录，将登录窗口显示出来，点击手机号登录，将当前视图隐藏，显示表单视图，点击登录时请求登录数据，同时将当前登录状态传入top.vue的组件用于数据渲染。 比较粗糙的是，我还没对输入进行校验，如果你想接着完善，可以自己动手做做。

+ **踩坑**

  由于接口进行了缓存处理，相同的 url 会在两分钟内只向网易服务器发一次请求，如果遇到不需要缓存结果的接口 , 可在请求 url 后面加一个时间戳参数使 url 不同。具体在node_modules/axios/lib/core/Axios.js下

  > utils.forEach(['delete', 'get', 'head', 'options'], function forEachMethodNoData(method) {
  >
  >  /*eslint func-names:0*/
  >
  >  Axios.prototype[method] = function(url, config) {
  >
  >   return this.request(utils.merge(config || {}, {
  >
  >    method: method,
  >
  >    url: url.indexOf('?') == '-1'?url+'?_=' + Date.now() :url + '&_=' + Date.now()
  >
  >   }));
  >
  >  };
  >
  > });